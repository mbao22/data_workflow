name: Deploy to Cloud Studio

on:
  release:
    types: [published]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Create deployment package
      run: |
        # Create a clean deployment directory
        mkdir -p deployment
        cp -r app.py requirements.txt templates/ deployment/
        
        # Create sample data for deployment
        echo "customer_id,name,dob,province,city,email,address" > deployment/"customer data.txt"
        echo "1,Deploy User,1990-01-01,Beijing,Beijing,deploy@example.com,Deploy Address" >> deployment/"customer data.txt"
        
        echo "order_id,customer_id,order_date,product,quantity,amount,status" > deployment/"order data.txt"
        echo "1,1,2024-01-01,Deploy Product,1,100.00,completed" >> deployment/"order data.txt"
        
        # Create deployment info file
        echo "Deployment Package" > deployment/DEPLOYMENT_INFO.txt
        echo "Created: $(date)" >> deployment/DEPLOYMENT_INFO.txt
        echo "Version: ${{ github.ref_name }}" >> deployment/DEPLOYMENT_INFO.txt
        
    - name: Upload deployment package
      uses: actions/upload-artifact@v3
      with:
        name: data-workflow-deployment
        path: deployment/